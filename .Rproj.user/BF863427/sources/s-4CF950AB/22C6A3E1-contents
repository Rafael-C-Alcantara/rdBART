#include "tree.h"
#include "treeProposal.h"
#include "utilities.h"
#include "metropolis.h"
#include "gibbs.h"

// Obtain draws of theta for each node
// [[Rcpp::export]]
Rcpp::List thetaDraw(Rcpp::List tree, const arma::mat& W, Rcpp::NumericMatrix X, const arma::vec& y, int m, double sigma)
{
  Rcpp::List out;
  Rcpp::List Lambda = lambdaPosterior(tree,W,X,m,sigma);
  Rcpp::List theta  = thetaPosterior(tree,W,X,y,Lambda,sigma);
  for (int i=0; i<theta.length(); i++)
    {
      out.push_back(mvrnormArma(1,theta[i],Lambda[i]));
    }
  return out;
}
// Assign the correct draw for each y
// [[Rcpp::export]]
arma::mat yDraw(Rcpp::List tree, const arma::mat& W, Rcpp::NumericMatrix X, const arma::vec& y, int m, double sigma, Rcpp::List draws)
{
  Rcpp::IntegerVector yFit = fit(tree,W);
  Rcpp::NumericVector bn = bottomNodes(tree);
  int params = X.ncol();
  int obs = X.nrow();
  arma::mat out(obs,params);
  
  for (int i=0; i<yFit.length(); i++)
    {
      for (int j=0; j<bn.length(); j++)
	{
	  arma::mat draw = draws[j];
	  if (yFit[i] == bn[j]) out.row(i) = draw;
	}
    }
  return out;
}
